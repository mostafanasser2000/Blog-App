{% extends 'base.html' %}
{%load blog_tags%}

{% block title %}
{{post.title|upper}}
{% endblock title %}

{% block content %}
<div class="post box">
        <div class="author-info">
            <div class="avatar">
                <a href="{% url 'author' post.author%}"><img src="{{post.author.profile.avatar.url}}" alt="{{post.author}}"
                    decoding="async"></a>
            </div>
            <div class="text">
                <a href="{% url 'blog:posts_by_author' post.author.username%}">{{post.author|title}}</a>
                <i class="fas fa-calendar"></i><span class="date">{{post.published_at|date:"j F Y"}}</span>
            </div>
        </div>

        <h1 class="text-center">
            {{post.title}}
        </h1>
        <div class="tags text-center">
            <div class="tags-box">
                 {% for tag in post.tags.all %}
            <a href="{% url 'blog:posts_by_tag' tag.slug%}">{{tag.name}}</a>
        {% endfor %}
            </div>
       
        </div>

        <div class="post-icons">
            <div class="text">
            {% if user.is_authenticated %}
               {% if liked_post %}
                <a href="{% url 'blog:post_dislike' post.id%}"><span><i class="liked fa fa-heart" title="likes"></i>{{post.likes.count}}</span></a>
               {%else%}
                <a href="{% url 'blog:post_like' post.id%}"><span><i class="disliked fa fa-heart" title="likes"></i>{{post.likes.count}}</span></a>
               {% endif %}
            {% else %}
                <span><i class="liked fa fa-heart" title="likes"></i>{{post.likes.count}}</span>
            {% endif %}
           
                <a href="#comments"><span><i class="fa fa-comment" title="comments"></i>{{comments.count}}</span></a>
                <a href="{%url 'blog:post_share' post.id%}" title="share"><i class="fa fa-share-from-square"></i></a>
            </div>
            {% if user.is_authenticated and user == post.author%}
            <div class="edit">
                <a href="{% url 'blog:post_update' post.id%}" title="edit"><i class="edit fa fa-edit"></i></a>
                <a href="{% url 'blog:post_delete' post.id%}" title="delete"><i class="delete fa fa-trash-alt"></i></a>
            </div>
            {% endif %}
        </div>

        <div class="post-content">
            {{post.content|markdown}}
        </div>

        <div class="comments" id="comments">
        <h3 class="text-center">Comments ({{comments.count}})</h3>
        {% if user.is_authenticated %}
            {% include "blog/includes/comment_form.html" %}
        {% endif %}
        {% for comment in comments %}
            <div class="comment">
                <p class="author">{{comment.user}}</p>
                <span class="date">{{comment.created_at}}</span>
                <p class="message">{{comment.body}}</p>
            </div>
        {%empty%}
        <p>There are no comments</p>
        {% endfor %}
    </div>
</div>
  
{% endblock content %}
{% block sidebar %}
<div class="sidebar">
    <ul class="related-posts" id="sidebar">
        <li>Related Posts</li>
        {% for post in related_posts %}
        <li><a href="{{post.get_absolute_url}}">{{post.title}}</a></li>
        {%empty%}
        <li>There are no similar posts yet.</li>
        {% endfor %}
    </ul>
</div>
{% endblock sidebar %}